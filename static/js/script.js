const defaultSetting = {
    icon: "https://q.qlogo.cn/headimg_dl?dst_uin=1498934815&spec=640",
    name: "JASMIAM",
    info: "除了死亡，一切失败都只存在于心理层面",
    z_index: 9999,
    blur: "#write",
    darkmode: 1,
    maxWidth: "480px",
    mini: true,
    hitokoto: {
        enable: true,
        cats: ["d", "i", "k"],
        offline: [
            "我去旅行，是因为我决定了要去，并不是因为对风景的兴趣",
            "我之所以想变强，是为了活得轻松写意",
            "心要滚动一下，才能变成石子",
            "即使如此，我也有我想保护的世界",
            "纵然越过死谷，亦不惧怕其祸，因及与我同在",
            "雾柳暗时云度月，露荷翻处水流萤",
            "秋阴不散霜飞晚，留得枯荷听雨声",
            "渐秋阑、雪清玉瘦，向人无限依依",
            "不茶不饭，不言不语，一味供他憔悴",
            "雨过月华生，冷彻鸳鸯浦",
            "世界上最远的距离是，我想和你叙叙旧，你却问我要不要代购",
            "飞鸟不留痕，但我已飞过",
            "吴姬越艳楚王妃，争弄莲舟水湿衣",
            "离心何以赠，自有玉壶冰",
            "冬天之所以那么冷是为了告诉大家身边人的温暖有多重要",
            "惊喜是个双黄蛋，绝望就是个双黄连",
            "一庭春色恼人来，满地落花红几片",
            "霜雪吹满头，也算是白首",
            "真正珍惜时间的人不会找任何借口……可惜我不是",
            "互联网时代的悲哀就是让你知道了皇帝的生活，而你只是个佃户",
            "儿女纷纷夸结束，新样钗符艾虎",
            "星星之火，可以燎原",
            "纸灰飞作白蝴蝶，泪血染成红杜鹃",
            "希望只在一瞬之间，而黑暗，永恒",
            "只有在车站大排长龙时，才能真正意识到，自己是龙的传人",
            "神即道，道即法，道法自然，如来",
            "那是，未满秒的邂逅",
            "飘零疏酒盏，离别宽衣带",
            "曾经以为三十岁很远，不料现在，十八岁已是很久以前",
            "我被生活磨光了棱角，简单的说就是，我被生活盘了",
            "但原来你一直都注视着别的世界",
            "玉树歌残犹有曲，锦帆归去已无家",
            "该走的就让它走，多说一句都是求",
            "中岁颇好道，晚家南山陲陲",
            "我是个干净的人，既没有恋爱的酸臭，又没有金钱的铜臭",
            "心心视春草，畏向阶前生",
            "你若要喜爱你自己的价值，你就得给世界创造价值",
            "能不能借我一毛钱？以免我们，一毛钱关系都没有",
            "不是他，变成他",
            "生当作人杰，死亦为鬼雄",
            "成熟的人眼里满是前途，稚嫩的人眼里满是爱恨情仇",
            "我要亲手击杀这乱世，并狠狠地还上一刀",
            "拆桐花烂漫，乍疏雨、洗清明",
            "扬言陪我走完一生的你总是迷路",
            "愿你每一步，坦荡无憾；愿你未来路，自信从容"
        ],
        color: "#70a1ff",
    },
    iconLinks: [{
            title: "My Github",
            url: "https://github.com/1498934815",
            icon: "fa-brands fa-github",
            target: "_blank"
        }, {
            title: "My Email",
            url: "mailto:1498934815@qq.com",
            icon: "fa-solid fa-envelope"
        }, {
            title: "bilibili",
            url: "https://b23.tv/EscDwn5",
            icon: "fa-brands fa-bilibili",
            target: "_blank"
        }, {
            title: "MT",
            url: "https://bbs.binmt.cc/home.php?mod=space&uid=147108&do=profile",
            icon: "fa-solid fa-m",
            target: "_blank"
        }, {
            title: "weixin",
            url: "http://photogzmaz.photo.store.qq.com/psc?/V50C52gl0PkrWX2gWYQs4PCFNF0ct9iP/TmEUgtj9EK6.7V8ajmQrEDibx1dzQJ6XeR4Vi4FI2rYU6*XysjAm7X18jlAnGaNpS7gZi7VmijpbyHAalHigFm86GrQJVoZv9oD9rOSRIYU!/b&bo=ugMTBboDEwUDEDU!&rf=mood_app&t=5",
            icon:"fab fa-weixin"
        }, {
            title: "qq",
            url: "mqqopensdkapi://bizAgent/qm/qr?url=https%3A%2F%2Fqm.qq.com%2Fcgi-bin%2Fqm%2Fqr%3Fk%3DtYrhpSkPVMGRrU_u6RBUcYwsXQAxh_b_%26jump_from%3D%26auth%3D%26app_name%3D%26authSig%3D%26source_id%3D3_40001",
            icon: "fab fa-qq",
        }, {
            title: "users",
            url: "mqqapi://card/show_pslcard?src_type=internal&version=1&uin=1054810204&card_type=group&source=qrcode",
            icon:"fas fa-users"
        }],
        links: [{
            title: "Lua-So",
            type: "default",
            url: "https://1498934815.github.io/Lua-So/",
        }, {
            title: "看！",
            type: "default",
            url: "https://1498934815.github.io/xjj/",
        }, {
            title: "图片格式工具",
            type: "default",
            url: "https://1498934815.github.io/Skeuomorphic/",
        }, {
            title: "测试",
            type: "default",
            url: "https://1498934815.github.io/xyx/",
        }]
};

let myukiGCard, cardBox, cardMini;

function calculateRuntime() {
    const startDate = new Date('2025-09-05T18:12:52');
    const currentDate = new Date();
    
    let diff = currentDate - startDate;
    
    const years = Math.floor(diff / (1000 * 60 * 60 * 24 * 365));
    diff -= years * (1000 * 60 * 60 * 24 * 365);
    
    const months = Math.floor(diff / (1000 * 60 * 60 * 24 * 30));
    diff -= months * (1000 * 60 * 60 * 24 * 30);
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    diff -= days * (1000 * 60 * 60 * 24);
    
    const hours = Math.floor(diff / (1000 * 60 * 60));
    diff -= hours * (1000 * 60 * 60);
    
    const minutes = Math.floor(diff / (1000 * 60));
    diff -= minutes * (1000 * 60);
    
    const seconds = Math.floor(diff / 1000);
    
    return {
        years: years,
        months: months,
        days: days,
        hours: hours,
        minutes: minutes,
        seconds: seconds
    };
}

function formatRuntime() {
    const runtime = calculateRuntime();
    let result = '';
    
    if (runtime.years > 0) {
        result += `${runtime.years}年`;
    }
    if (runtime.months > 0) {
        result += `${runtime.months}月`;
    }
    if (runtime.days > 0) {
        result += `${runtime.days}天`;
    }
    result += `${runtime.hours}时${runtime.minutes}分${runtime.seconds}秒`;
    
    return `<span class="runtime-item">${result}</span>`;
}

function createCard() {
    myukiGCard = document.createElement("div");
    myukiGCard.className = "myuki-gcard_mask";
    myukiGCard.style.zIndex = defaultSetting.z_index;

    cardBox = document.createElement("div");
    cardBox.className = "myuki-gcard_box";
    cardBox.style.maxWidth = defaultSetting.maxWidth;

    const cardIcon = document.createElement("div");
    cardIcon.className = "myuki-gcard_icon";
    const img = document.createElement("img");
    img.src = defaultSetting.icon;
    img.alt = defaultSetting.name;
    img.loading = "lazy";
    cardIcon.appendChild(img);
    cardBox.appendChild(cardIcon);

    const cardName = document.createElement("div");
    cardName.className = "myuki-gcard_title";
    cardName.textContent = defaultSetting.name;
    cardBox.appendChild(cardName);

    const cardInfo = document.createElement("div");
    cardInfo.className = "myuki-gcard_info";
    const p = document.createElement("p");
    p.textContent = defaultSetting.info;
    cardInfo.appendChild(p);
    
    fetch(`https://v1.hitokoto.cn/?c=d&c=i&c=k`)
        .then(res => res.json())
        .then(data => {
            const p = document.createElement("p");
            const a = document.createElement("a");
            a.target = "_blank";
            a.textContent = `「${data.hitokoto}」`;
            a.href = `https://hitokoto.cn?uuid=${data.uuid}`;
            p.className = "myuki-gcard_hitokoto";
            p.style.color = defaultSetting.hitokoto.color;
            p.appendChild(a);
            cardInfo.appendChild(p);
        })
        .catch(() => {
            const p = document.createElement("p");
            p.className = "myuki-gcard_hitokoto";
            p.style.color = defaultSetting.hitokoto.color;
            const randomIndex = Math.floor(Math.random() * defaultSetting.hitokoto.offline.length);
            p.textContent = `「${defaultSetting.hitokoto.offline[randomIndex]}」`;
            cardInfo.appendChild(p);
        });
    
    const runtimeElement = document.createElement("div");
    runtimeElement.className = "myuki-gcard_runtime";
    runtimeElement.innerHTML = `<div>本站运行时间: ${formatRuntime()}</div>`;
    cardInfo.appendChild(runtimeElement);
    
    setInterval(() => {
        runtimeElement.innerHTML = `<div>本站运行时间: ${formatRuntime()}</div>`;
    }, 1000);
    
    cardBox.appendChild(cardInfo);

    const iconList = document.createElement("div");
    iconList.className = "myuki-gcard_icon-list";

    defaultSetting.iconLinks.forEach(link => {
        const iconLink = document.createElement("a");
        iconLink.className = "myuki-gcard_icon-item";
        if (link.title) iconLink.title = link.title;
        
        const icon = document.createElement("i");
        icon.className = link.icon;
        iconLink.appendChild(icon);
        
        iconLink.target = link.target || "_self";
        iconLink.href = link.url || "javascript:void(0);";
        iconList.appendChild(iconLink);
    });

    cardBox.appendChild(iconList);

    const cardBtnList = document.createElement("div");
    cardBtnList.className = "myuki-gcard_btn-list";

    defaultSetting.links.forEach(link => {
        const btn = document.createElement("a");
        btn.className = `myuki-gcard_btn btn-${link.type || "default"}`;
        btn.setAttribute("btn-type", link.type || "default");
        
        btn.target = link.target || "_self";
        btn.href = link.url || "javascript:void(0);";
        btn.textContent = link.title;
        
        cardBtnList.appendChild(btn);
    });

    const closeBtn = document.createElement("a");
    closeBtn.className = "myuki-gcard_btn btn-close";
    closeBtn.href = "javascript:void(0);";
    closeBtn.textContent = "关闭窗口";
    closeBtn.addEventListener("click", () => {
        closeCard();
    });
    
    cardBtnList.appendChild(closeBtn);
    cardBox.appendChild(cardBtnList);

    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        cardBox.classList.add("darkmode");
    }

    myukiGCard.appendChild(cardBox);
    document.body.appendChild(myukiGCard);

    if (defaultSetting.mini) {
        createMiniIcon();
    }
}

function createMiniIcon() {
    cardMini = document.createElement("div");
    cardMini.className = "myuki-gcard_mini";
    
    const miniImg = document.createElement("img");
    miniImg.src = defaultSetting.icon;
    miniImg.loading = "lazy";
    cardMini.appendChild(miniImg);
    cardMini.style.zIndex = defaultSetting.z_index;
    
    cardMini.addEventListener("click", () => {
        openCard();
    });
    
    document.body.appendChild(cardMini);
}

function closeCard() {
    cardBox.classList.add("closed");
    setTimeout(() => {
        myukiGCard.classList.add("hidden");
        if (defaultSetting.mini && cardMini) {
            cardMini.classList.add("shown");
        }
    }, 600);
}

function openCard() {
    myukiGCard.classList.remove("hidden");
    cardBox.classList.remove("closed");
    if (defaultSetting.mini && cardMini) {
        cardMini.classList.remove("shown");
    }
}

window.addEventListener("DOMContentLoaded", createCard);